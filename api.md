# 接口文档

### 1. 图形验证码
###### 逻辑
```
参考当前官网


```
### 2. 注册/登录/退出
###### 逻辑
```
参考当前官网
短信验证码淼科提供服务 我们存redis并校验

注: 脱敏

涉及表
p2pUser

```
### 3. 是否实名接口----后台手动审核的也算
###### 逻辑
```
advance认证成功的和后台手动审核的状态可能不一样 都为已实名

```
### 4. 实名认证
###### 逻辑
```
填写实名认证信息
后台advance自动认证
认证失败的改为中间状态待后台手动审核

实名认证接口----参考当前官网

涉及表
p2pUser

```
### 5. 个人信息
###### 逻辑
```
个人中心>>>个人信息页面

查询用户信息 实名、绑卡 情况

涉及表
p2pUser p2pUserBank

```
### 6. 银行卡列表
###### 逻辑
```
参考doit-----/system/getBankInfo接口

涉及表
sysBankBasicInfo

```
### 7. 绑卡
###### 逻辑
```

卡bin  参考当前官网

涉及表
p2pUserBank

```
### 8. 个人中心---账户及投资信息
###### 逻辑
```
查询用户账户信息

接口名api-user/user/selectUserAccount
请求参数
sessionId
返回参数
 //用户id
    userUuid;
    //散标账户在投金额
    sanbiaoBalance;
    //散标账户冻结金额
    sanbiaoLockBalance;
    //活期账户余额
    currentBalance;
    //活期账户冻结金额
    currentLockBalance;
    //定期账户余额
    depositBalance;
    //定期账户冻结金额
    depositLockBalance;


查询用户投资记录
接口名 api-order/order/selectUsrOrderList
请求参数
sessionId
 status (value = "1.投资中 2.一结束")
 productType (value = "产品类型--1.散标 2活期账户 3.理财账户")
 starTime 开始时间
 endTime 结束时间
flag (value = "0.自选时间 1.全部 2今天 3.近一个月 4.近三个月")

返回参数

 "creditorNo": "99999944444",
        "amountBuy": 100000000,
        "term": 7,
        "yearRateFin": 0,
        "buyTime": 1536137610000,
        "dueTime": null,
        "actReturnTime": null,
        "createTime": 1536137611000,
        "income": 100000000,
        "status": 1,
        "productType": 1,
        "sort": 5

涉及表
账户表、账户明细表

```
### 9. 接收债权信息 
**逻辑**

    我方提供接口 接收债权信息（散标） 供doit调用(for 怀舟) 
    存入原始债权表

        贷款用途
        风险等级（确认等级）
        债权编号（借款订单编号）
        理财年化利率	
        期限	
        申请金额
        贷款年化利率
        前置服务费（借款人砍头息金额）
        发标时间
        下单用户(借款人uuid)
        借款人-银行卡开户行简称bankCode
        借款人-银行名称
        借款人-银行卡号
        借款人-银行卡持有人姓名
        来源（默认为doit)
        
    存入散标表
    
        债权编号（借款订单编号）
        锁定金额(默认0,有用户下单N印尼盾时锁定金额增加N，付款成功锁定金额减少N购买金额增加N，锁定超时锁定金额减少N)
        购买金额(默认0，付款成功锁定金额减少N购买金额增加N)
        订单状态(默认投标中)
        放款时间(默认空)
        应还款时间(放款成功后 同放款时间一起更新)
        
        还款时间(默认空，还款成功更新)
        逾期滞纳金(默认0,还款接口内更新)
        逾期服务费(默认0,还款接口内更新)
        利息(默认0,还款接口内更新)

    通过接收到的借款人ID调用接口10查询借款用户部分信息
**涉及表**
    
    原始债权表、散标表、借款人信息表
### 10. 通过借款人ID查询借款用户部分信息
###### 逻辑
```
我方接收到债权信息（散标）后通过借款人ID查询借款用户部分信息 （doit提供查询接口 for怀舟）
----------save借款人信息表--------------
借款人ID
手机号
真实姓名
身份证号	
出生日期
年龄
性别，0：未知，1：男，2：女
学历
借款人身份：家庭主妇
邮箱地址	
宗教
居住地址
身份证信息(已认证)
银行卡信息(已认证)	
联系人信息(已认证)
保险卡信息(已认证)
家庭卡信息(已认证)

涉及表
借款人信息表

接口名api-order/order/selectLenderUserInfo
请求参数
{"sessionId":"123","creditorNo":"1111"}
返回值
 "lenderId": "E916A745196F41939A0263D86A3FF9F0",
    "name": "Rina Herlina Mulviyusnah",
    "idCardNo": "3175066301950004",
    "sex": "2",
    "age": 0,
    "isMarried": null,
    "identidy": "2",
    "mobile": "",
    "email": "rinaherlina2301@gmail.com",
    "acdemic": "Sekolah Menengah Atas",
    "birty": "23/1/1995",
    "religion": "Islam",
    "address": "Jalan Bakti 3 No.32 Rt.009/Rw.006 Cilincing",
    "isIdentidyAuth": "1",
    "isBankCardAuth": "1",
    "isLindManAuth": "1",
    "isInsuranceCardAuth": "0",
    "isFamilyCardAuth": "1"

```
### 11. 查询投资用户有无doit借款
###### 逻辑
```
姓名、身份证号、手机号 字段待确认

对接doit----------怀舟提供查询接口

```
### 12. 散标列表
###### 逻辑
```
按条件分页查询散标表中订单状态(默认投标中)的数据
接口名 api-order/order/selectScatterstandardList

请求参数
yearRateFin 理财年化利率
amountApply 申请金额
term 期限

返回参数
creditorNo 债权编号
borrowingPurposes 风险等级
amountApply 申请金额
yearRateFin 年化利率

```

### 13. 购买
###### URL
    http://172.17.59.215:8888/api-order/p2p/pay/income/immediateInvestment
###### param
    {
    	"creditorNo":"99999944444",
    	"userUuid":"111",
    	"userName":"huahu",
        "amount":100000000
    }
###### 逻辑
```
调用接口11查询用户有无doit借款
有 提示错误不能购买
判断有误超过限额
有 提示无法投资或联系客服

无  散标表锁定份额 暂定30分钟
查询绑定的银行卡
---付款流程----
添加订单记录----状态为投资处理中
记录购买债权流水
调用淼科支付接口



涉及表
p2pUser  散标表 订单表 流水表 用户银行卡表........

```
### 14. 还款接口for doit
###### 逻辑
```


doit 判断如果是p2p平台放款的订单还款则调用此接口

直接还到托管账户

```

### 15. 收款放款结果确认
###### 逻辑
```
收款结果 ---对接淼科
放款结果 ---对接淼科


接收到购买债权的收款结果-----更改订单和流水状态
成功---散标购买金额+订单金额，散标锁定金额-订单金额，满标更改状态，记录用户账户和账户明细
失败---提示用户失败原因

------------------------------------------
接收到放款的支付结果-----更改散标表状态 放款时间，应还时间，调用接口16通知doit

接收到还款的支付结果-----更改散标表状态 还款时间，调用接口16通知doit
还款清分清分清分
息差>>>>收入账户 回款收入
滞纳金>>收入账户 滞纳金收入
本金+收益>>>>>p2p投资用户 回款

接收到投资回款的支付结果-------

接收到前置服务费的支付结果-----

接收到回款收入的支付结果-------



```

### 16. doit提供
###### 逻辑
```
订单状态变更接口 如 放款成功失败，还款成功失败等

```

### 17. 借款服务协议
###### 逻辑
```


```

### 18. 学生借款申请
###### 逻辑
```
学生借款表保存数据

```



## 定时任务
### 6小时后处理订单(1.超级投资人合买 2.流标 3.满标放款)
```
散标锁定金额+购买金额=0则为流标  

散标锁定金额=0 购买金额=借款金额 满标

借款金额>散标锁定金额+购买金额>0 未满标

或者直接查询散标状态


(6小时临界点有锁定在付款的先不处理?那个锁定中是不是可以还用到这保证不会有新的用户再来买而在6小时外再次锁定金额？)

流标调用接口16通知doit
未满标 超级投资人合买
满标清分放款
前置服务费>>>收入账户
借款金额-前置服务费>>>>放款到借款用户

```


## 后台接口
### 投资用户分页列表接口 
### 实名审核接口
### 学生借款表----审核、线下放款

---
---
---

